@rendermode InteractiveWebAssembly
@using MudBlazor

<MudCard>
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h6">@Comic.Title</MudText>
            <MudText Typo="Typo.body2">#@Comic.IssueNumber</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            <MudIconButton Icon="@Icons.Material.Filled.FavoriteBorder" Color="Color.Default"
                OnClick="OnFavoriteToggled">
            </MudIconButton>
        </CardHeaderActions>
    </MudCardHeader>

    <MudCardContent>
        <MudGrid Spacing="1">
            <MudItem xs="12">
                <MudChip T="string" Size="Size.Small" Color="Color.Primary" Variant="Variant.Text">@Comic.Era</MudChip>
                <MudChip T="string" Size="Size.Small" Color="Color.Secondary" Variant="Variant.Text" Class="ml-2">
                    @Comic.Publisher</MudChip>
            </MudItem>

            <MudItem xs="12">
                <MudText Typo="Typo.caption"><strong>Condition:</strong></MudText>
                <MudText Typo="Typo.body2">@Comic.ConditionGrade</MudText>
            </MudItem>

            @if (!string.IsNullOrEmpty(Comic.Characters))
            {
                <MudItem xs="12">
                    <MudText Typo="Typo.caption"><strong>Characters:</strong></MudText>
                    <MudText Typo="Typo.body2">@Comic.Characters</MudText>
                </MudItem>
            }

            <MudItem xs="12">
                @if (Comic.IsAvailable)
                {
                    <MudChip T="string" Size="Size.Small" Color="Color.Success" Variant="Variant.Filled"
                        Icon="@Icons.Material.Filled.CheckCircle">
                        Available for Loan
                    </MudChip>
                }
                else
                {
                    <MudChip T="string" Size="Size.Small" Color="Color.Warning" Variant="Variant.Filled"
                        Icon="@Icons.Material.Filled.Schedule">
                        On Loan
                    </MudChip>
                }
            </MudItem>
        </MudGrid>
    </MudCardContent>

    <MudCardActions>
        <MudButton Size="Size.Small" Variant="Variant.Text" Color="Color.Primary" OnClick="OnViewDetails">View Details
        </MudButton>
        @if (Comic.IsAvailable)
        {
            <MudButton Size="Size.Small" Variant="Variant.Text" Color="Color.Secondary" OnClick="OnMakeOffer">Request Loan
            </MudButton>
        }
        <MudSpacer></MudSpacer>
        <MudButton Size="Size.Small" Variant="Variant.Text" Color="Color.Default" OnClick="OnContactOwner">
            <MudIcon Icon="@Icons.Material.Filled.Mail"></MudIcon>
        </MudButton>
    </MudCardActions>
</MudCard>

@code {
    [Parameter]
    public ComicItem Comic { get; set; } = new();

    [Parameter]
    public EventCallback OnViewDetailsClicked { get; set; }

    [Parameter]
    public EventCallback OnMakeOfferClicked { get; set; }

    [Parameter]
    public EventCallback OnFavoriteClicked { get; set; }

    [Parameter]
    public EventCallback OnContactOwnerClicked { get; set; }

    public class ComicItem
    {
        public int Id { get; set; }
        public string Title { get; set; } = string.Empty;
        public int IssueNumber { get; set; }
        public string Publisher { get; set; } = string.Empty;
        public string Characters { get; set; } = string.Empty;
        public string Era { get; set; } = string.Empty;
        public string ConditionGrade { get; set; } = string.Empty;
        public bool IsAvailable { get; set; } = true;
        public int OwnerId { get; set; }
        public string OwnerUsername { get; set; } = string.Empty;
    }

    private async Task OnViewDetails()
    {
        await OnViewDetailsClicked.InvokeAsync();
    }

    private async Task OnMakeOffer()
    {
        await OnMakeOfferClicked.InvokeAsync();
    }

    private async Task OnFavoriteToggled()
    {
        await OnFavoriteClicked.InvokeAsync();
    }

    private async Task OnContactOwner()
    {
        await OnContactOwnerClicked.InvokeAsync();
    }
}